---
import Baselayout from '../layouts/Baselayout.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog');
const allProjects = await getCollection('projects');
const allPhotos = await getCollection('photography');

const recentPosts = allPosts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf()).slice(0, 3);
const recentProjects = allProjects.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf()).slice(0, 3);
const recentPhotos = allPhotos.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf()).slice(0, 3);

const formatDate = (date: Date) => {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
};
---
<Baselayout pageTitle="Home">
    <section>
        <p class="intro">
            Software engineer, photographer, and minimalist. Exploring the intersection of technology and art.
        </p>
				<p>
								You can find me on <a href="https://github.com/" target="_blank">GitHub</a>, 
								<a href="https://linkedin.com/in/" target="_blank">LinkedIn</a>, or send me an 
								<a href="mailto:your.email@example.com">email</a>.
				</p>
    </section>
    
    <section>
        <div class="section-header">
            <h2>Blog</h2>
            <a href="/posts" class="view-all">View all &rarr;</a>
        </div>
        <div class="grid">
            {recentPosts.map((post) => (
                <article class="card">
                    <span class="date">{formatDate(post.data.date)}</span>
                    <h3><a href={`/posts/${post.id}`}>{post.data.title}</a></h3>
                    <p>{post.data.description || "No description available."}</p>
                </article>
            ))}
        </div>
    </section>

    <section>
        <div class="section-header">
            <h2>Projects</h2>
            <a href="/projects" class="view-all">View all &rarr;</a>
        </div>
        <div class="grid">
            {recentProjects.map((project) => (
                <article class="card">
                    <span class="date">{formatDate(project.data.date)}</span>
                    <h3><a href={`/projects/${project.id}`}>{project.data.title}</a></h3>
                    <p>{project.data.description}</p>
                </article>
            ))}
        </div>
    </section>
    
    <section>
        <div class="section-header">
            <h2>Photography</h2>
            <a href="/photography" class="view-all">View all &rarr;</a>
        </div>
        <div class="grid">
            {recentPhotos.map((photo) => (
                <article class="card">
                    <span class="date">{formatDate(photo.data.date)}</span>
                    <h3><a href={`/photography/${photo.id}`}>{photo.data.title}</a></h3>
                    <p>{photo.data.description}</p>
                </article>
            ))}
        </div>
    </section>
</Baselayout>
