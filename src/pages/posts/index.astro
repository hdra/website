---
import Baselayout from '../../layouts/Baselayout.astro';
import { getCollection } from "astro:content";

const allPosts = await getCollection("blog", ({data}) => {
    return data.date >= new Date('2017-01-01');
});
const sortedPosts = allPosts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const formatDate = (date: Date) => {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
};
---

<Baselayout pageTitle="Blog">
    <div class="section-header">
        <h2>Blog</h2>
    </div>
    
    <div class="grid">
        {sortedPosts.map((post) => (
            <article class="card">
                <span class="date">{formatDate(post.data.date)}</span>
                <h3><a href={`/posts/${post.id}`}>{post.data.title}</a></h3>
                <p>{post.data.description}</p>
            </article>
        ))}
    </div>

    <div style="margin-top: 3rem; text-align: center;">
        <a href="/posts/archives" style="font-family: var(--font-sans); font-size: 0.9rem;">View Archives (Pre-2017) &rarr;</a>
    </div>
</Baselayout>